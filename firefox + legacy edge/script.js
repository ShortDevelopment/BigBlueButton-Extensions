let injectionID = "lhdrrdhbkgtveszetburdtuudv";
let injectionHTML = `<div class="contextmenu_i_lk">
	<button onmousedown="contextmenu_i_lk_click(this, event);">😀</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😁</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😂</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😃</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😄</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😅</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😆</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😇</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😈</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😉</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😊</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😋</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😌</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😍</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😎</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😏</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😐</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😑</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😒</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😓</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😔</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😕</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😖</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😗</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😘</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😙</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😚</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😛</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😜</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😝</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😞</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😟</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😠</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😡</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😢</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😣</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😤</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😥</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😦</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😧</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😨</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😩</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😪</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😫</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😬</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😭</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😮</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😯</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😰</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😱</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😲</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😳</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😴</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😵</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😶</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😷</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😸</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😹</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😺</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😻</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😼</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😽</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😾</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">😿</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">🙀</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">🙁</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">🙂</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">🙃</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">🙄</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">🙅</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">🙆</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">🙇</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">🙈</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">🙉</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">🙊</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">🙋</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">🙌</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">🙍</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">🙎</button>
	<button onmousedown="contextmenu_i_lk_click(this, event);">🙏</button>
</div>
<style>
	.contextmenu_i_lk{
		border:2px solid #0f70d7;
		border-radius:5px;
		padding:3px;
		background-color: rgb(243, 246, 249);
		display:inline-block;
		width:400px;
		max-height:100px;
		overflow-y:auto;
		text-align:center;
	}
	.contextmenu_i_lk button{
		display:inline-block;
		margin:5px;
		border-radius:50%;
		padding:8px;
		background:transparent;
		border:none;
		cursor:pointer;
		font-size:20px;
	}
	.contextmenu_i_lk button:hover{
		box-shadow: 0px 0px 0px 2px #54a1f3, inset 0px 0px 0px 1px #0f70d7;
	}
</style>`;

let injectJS = `function contextmenu_i_lk_click(ele, e) {
		document.dispatchEvent(new CustomEvent('contextmenu_i_lk_ele_insert', {
			detail: ele.innerText,
		}));
	}`;

const inject = () => {
	let div = document.getElementById(injectionID);
	if (div == undefined || div == null){
		div = document.createElement("div");
		div.setAttribute("id", injectionID);
		div.setAttribute("tabindex", "-1");
		div.id = injectionID;
		div.style.position = "fixed";
		div.style.zIndex = "10000";
		div.style.outline = "none";
		div.innerHTML = injectionHTML;
		document.body.appendChild(div);
		div.addEventListener("blur", () => {
			div.style.display = "none";
		});
		let js = document.createElement("script");
		js.innerHTML = injectJS;
		document.body.appendChild(js);
	}
	let eles = document.getElementsByTagName("textarea");
	for(let i = 0; i < eles.length; i++){
		let ele = eles[i];
		if(ele.getAttribute("data-inject") != "true"){			
			ele.setAttribute("data-inject", "true");
			ele.addEventListener("contextmenu", (e) => {
				e.preventDefault();
				let div = document.getElementById(injectionID);				
				let style = div.style;
				style.display = "block";
				div.focus();
				let rect = ele.getBoundingClientRect();
				style.left = (rect.left - 2) + "px";
				style.top = (rect.top - 110) + "px";
				window.contextmenu_i_lk_ele = ele;
			});
		}
	}
}

const insert = (e) => {
	window.contextmenu_i_lk_ele.focus();
	//window.contextmenu_i_lk_ele.innerHTML += e.detail;
	window.contextmenu_i_lk_ele.value += e.detail;
	document.getElementById(injectionID).style.display = "none";
}

document.addEventListener("DOMNodeInsertedIntoDocument", inject);
document.addEventListener("DOMNodeInserted", inject);

document.addEventListener("contextmenu_i_lk_ele_insert", insert);